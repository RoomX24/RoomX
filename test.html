<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Szoba Felület</title>
  <style>
    body {
      background-color: black;
      color: red;
      font-family: monospace;
      text-align: center;
      padding-top: 50px;
    }
    #countdown {
      font-size: 64px;
      margin-bottom: 40px;
    }
    #tip {
      font-size: 28px;
      background-color: red;
      color: black;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 8px;
      max-width: 80%;
      word-wrap: break-word;
      resize: none;
      overflow: hidden;
      width: 60%;
      height: auto;
      min-height: 40px;
      line-height: 1.5;
    }
    #codeInput {
      margin-top: 20px;
      font-size: 18px;
      padding: 10px;
      width: 60%;
    }
    #codeButton {
      padding: 10px;
      background-color: red;
      color: black;
      border: none;
      font-size: 18px;
      margin-top: 10px;
    }
    #startButton {
      margin-top: 20px;
      padding: 10px;
      background-color: green;
      color: white;
      border: none;
      font-size: 18px;
    }
    #stopButton {
      margin-top: 20px;
      padding: 10px;
      background-color: blue;
      color: white;
      border: none;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="countdown">00:00</div>
  <div id="tip">Tipp: (nincs még megadva)</div>

  <hr>

  <!-- Kód beírása -->
  <input type="text" id="codeInput" placeholder="Írd be a kódot..." />
  <button id="codeButton" onclick="checkCode()">Kód Ellenőrzése</button>

  <!-- Indítás és leállítás gombok -->
  <button id="startButton" onclick="startTimer()">Óra Indítása</button>
  <button id="stopButton" onclick="stopTimer()">Óra Leállítása</button>

  <script>
    const correctCode = "1546"; // A helyes kód, amit be kell írni
    let codeUsed = false; // A kód használatának állapota
    let timerStarted = false; // Az óra állapota
    let timerStopped = false; // Az óra leállásának állapota

    // Formázza az időt
    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    // Frissíti a visszaszámlálót és a tippet
    function updateView() {
      const end = localStorage.getItem("countdownEnd");
      const countdownEl = document.getElementById("countdown");
      if (!end) {
        countdownEl.textContent = "00:00";
      } else {
        const remaining = Math.floor((end - Date.now()) / 1000);
        if (remaining <= 0) {
          countdownEl.textContent = "00:00";
        } else {
          countdownEl.textContent = formatTime(remaining);
        }
      }

      const tip = localStorage.getItem("roomTip");
      const tipEl = document.getElementById("tip");
      if (tip) {
        tipEl.textContent = "Tipp: " + tip;
      } else {
        tipEl.textContent = "Tipp: (nincs még megadva)";
      }
    }

    // Kód ellenőrzése
    function checkCode() {
      const enteredCode = document.getElementById("codeInput").value;
      let countdownEnd = localStorage.getItem("countdownEnd");

      if (!enteredCode) {
        alert("Kérlek, írd be a kódot!");
        return;
      }

      // Ha az óra elindult, de még nem állt le, akkor engedélyezze a kódot egyszeri használatra
      if (timerStarted && !timerStopped && !codeUsed) {
        if (enteredCode === correctCode) {
          // Helyes kód, adjunk hozzá 5 percet
          alert("Helyes kód! +5 perc!");
          if (!countdownEnd) {
            countdownEnd = Date.now() + 5 * 60 * 1000; // Ha még nincs időzítő, beállítjuk
          } else {
            countdownEnd = Number(countdownEnd) + 5 * 60 * 1000;
          }
          codeUsed = true; // A kód használata
          document.getElementById("codeInput").disabled = true; // Kód mező letiltása
        } else {
          // Hibás kód, vegyünk el 5 percet
          alert("Hibás kód! -5 perc!");
          countdownEnd = Number(countdownEnd) - 5 * 60 * 1000;
        }

        localStorage.setItem("countdownEnd", countdownEnd);
        document.getElementById("codeInput").value = ""; // Kód mező törlése
        updateView(); // Frissítés
      } else if (timerStopped) {
        alert("Az óra leállt, már nem használható a kód.");
      } else if (codeUsed) {
        alert("A kódot már egyszer használták.");
      } else {
        alert("Az óra nem indult el.");
      }
    }

    // Óra indítása
    function startTimer() {
      if (timerStarted) {
        alert("Az óra már elindult.");
        return;
      }

      // Indítsuk el az időzítőt
      const countdownEnd = Date.now() + 5 * 60 * 1000; // 5 perc
      localStorage.setItem("countdownEnd", countdownEnd);
      localStorage.setItem("timerStarted", "true");
      timerStarted = true; // Az óra elindult
      updateView(); // Frissítés
    }

    // Óra leállítása
    function stopTimer() {
      if (!timerStarted) {
        alert("Az óra még nem indult el.");
        return;
      }

      timerStopped = true; // Az óra leállt
      alert("Az óra leállt.");
    }

    // Frissíti a nézetet minden másodpercben
    setInterval(function() {
      updateView();
    }, 1000);

    updateView();
  </script>
</body>
</html>
